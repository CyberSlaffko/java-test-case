# * В004 2017-10-04 Новое от нашей команды: *
8 - реализовано

# * В003 2017-10-02 Новое от нашей команды: *
5,6,7 - реализовано

# * В002 2017-09-25 Новое от нашей команды: *
2. реализовано (нужно передать полный URL файла)
4. реализовано (для корректного отображений русских букв необходимо явно прописывать шрифты)

# * В001 2017-09-22 Новое от нашей команды: *
1. Применив springboot "переделали проект в Web-сервис".

2. В работе, надо добавить обработку URL (сейчас принимаются файлы с дисков).

3. Устранена проблема с нумерацией списков - но есть проблема с вложенными списками, скорее всего не поддерживается в таком виде, лучше переписать на docx4j, что потребует дополнительных затрат времени.

4. Документы преобразуются в PDF (FOP) - но на стандартных шаблонах ЕСПД возникает проблема с русскими буквами в парсере.

5.5.6. в работе, есть вопрос - предполагается набор документов в куче папок вложенных, и где-то в глубине может быть корневой? мы их скачиваем все в приложение и потом собираем/парсим.

7. Ничего пока.

8. Ничего пока.

б1. Ничего пока.

б2. Ничего пока.

# java-test-case
Конвертер документов Docbook в другие форматы

Данное приложение предназначено для преобразования документов Docbook версии 5 в другие форматы.

## Сборка
Производится с помощью команды Maven из корневой папки проекта:
```
mvnw clean install
```

## Запуск web-сервиса
Запуск осуществляется либо с помощью команды Maven'у из корневой папки проекта:
```
mvnw spring-boot:run -pl app
```
либо непосредственным запуском собранного jar-приложения (он является самозапускаемым со всеми необходимыми зависимостями): 
```
java -jar app-1.0-SNAPSHOT.jar
```

По-умолчанию приложение содержит внедренный сервер Tomcat, запускаемый на порту 8080. Другой порт можно указать с помощью параметра `server.port` через системное свойство или параметр командной строки. Подробнее о конфигурировании приложений spring-boot можно узнать из [документации](https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle).

## Использование web-сервиса
Сервис обслуживает http GET запросы следующего вида:
```
/converter/{filename}.{pdf|docx|png}?src={srcUrl}&tpl={tplUrl}&params={params}
```
и, если запрос выполняется успешно, возвращает результат в теле ответа. Если случается ошибка, то в теле ответа будет ее представление (в различных форматах, в зависимости от клиента).

Пример получения docx-документа:
```
/converter/generated.docx?src=https%3A%2F%2Fgithub.com%2FCyberSlaffko%2Fjava-test-case%2Fraw%2Fmaster%2Fdocbook-parser%2Fsrc%2Ftest%2Fresources%2Fwith_xinclude%2Findex.xml
```

Пример получения pdf-документа:
```
/converter/generated.pdf?src=https%3A%2F%2Fbitbucket.org%2FLab50%2Fespd-docbook5%2Fraw%2Fd244a2fa6fc03343a0c642713ff989e1d718d9d3%2F%25D1%2588%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD%25D1%258B%2F%25D0%25BF%25D0%25BE%25D1%258F%25D1%2581%25D0%25BD%25D0%25B8%25D1%2582%25D0%25B5%25D0%25BB%25D1%258C%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25B7%25D0%25B0%25D0%25BF%25D0%25B8%25D1%2581%25D0%25BA%25D0%25B0%2Fbook.xml&tpl=http%3A%2F%2Flab50.net%2Fxsl%2Fespd%2Fespd.xsl&params=%7B%27body.font.family%27%3A%27DejaVu+Serif%27%2C+%27sans.font.family%27%3A%27Liberation+Sans%27%2C+%27title.font.family%27%3A%27DejaVu+Sans%27%2C+%27monospace.font.family%27%3A%27DejaVu+Sans+Mono%27%2C+%27symbol.font.family%27%3A%27OpenSymbol%27%7D
```

Для тестирования в приложении есть простенькая страничка (`/index.html`), с которой можно выполнить запрос на конвертацию.

# Задание

1. Преобразовать приложение в web-сервис.
2. Добавить поддержку получения документов в формате Docbook из Git репозитория
(пример документа расположен в репозитории в папке с тестами)
3. Исправить ошибку, связанную с формированием нумерованных списков - в результирующем документе формата DOCX
все нумерованные списки продолжают сквозную нумерацию.
4. Добавить преобразование в PDF cпомощью XSLT трансформаций и Apache FOP процессора
(набор преобразований расположен в репозитории https://bitbucket.org/Lab50/espd-docbook5/src)
5. При загрузке репозитория с документом должна быть возможность выбора корневого файла документа.
5. При выборе корневого файла документа должна быть возможность выбрать шаблон преобразования.
6. Корневой файл не обязательно должен располагаться в корневой папке репозитория с документом
7. Должна поддерживаться возможность параллельного формирования нескольких документов одновременно
8. Должны поддерживаться инлайн изображения (изображения вставленные в строку с текстом)

# Бонусные задачи

1. Добавить возможность добавления новых шаблонов без перезапуска сервиса.
2. Повысить скорость преобразования документов. Сейчас преобразование больших документов занимает порядка 40 секунд.
